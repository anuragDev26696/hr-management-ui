<section class="content py-3 container-xl">
    <div class="row g-3">
        @defer (when isMasterSummaryLoaded) {
            @for (item of masterSummary | keyvalue; track item.key) {
                <aside class="col-sm-6 col-md-4 col-xl-3">
                    <div class="card topCards p-3" [class]="item.key === 'totalEmployee' ? 'text-bg-primary' : item.key === 'activeEmployee' ? 'text-bg-success' : item.key === 'departments' ? 'text-bg-warning' : item.key === 'leaveRequest' ? 'text-bg-danger' : item.key === 'recentRegistrations' ? 'text-bg-info' : ''">
                        <p class="h5 mb-0">{{item.key === "totalEmployee" ? "Total Employees" : item.key === "activeEmployee" ? "Active Employees" : item.key === "departments" ? "Departments" : item.key === "leaveRequest" ? "Leave Request" : item.key === "recentRegistrations" ? "Recent Registrations" : ""}} </p>
                        <span class="h3">{{item.value}}</span>
                    </div>
                </aside>
            }

        } @placeholder {
            @for (item of masterSummary | keyvalue; track item.key) {
                <aside class="col-sm-6 col-md-4 col-xl-3">
                    <div class="card p-3 placeholder-glow">
                        <p class="h5 rounded-1 mt-auto placeholder col-10"></p>
                        <h3 class="w-100 rounded-1 placeholder col-5">100</h3>
                    </div>
                </aside>
            }
        }
    </div>

    <div class="row g-3 mt-3">
        <!-- Attendance & Payroll Overview -->
        <div class="col-sm-6">
            <div class="card border-light shadow-sm p-3">
                <h5>Today's Attendance &nbsp;<span role="button" class="float-end text-primary rounded-5" [tabIndex]="-1" aria-label="Refresh to get latest status" (click)="refreshSummary($event)"><i class="bi bi-arrow-clockwise"></i></span></h5>
                @defer (when attendanceSummary) {
                    @let totalEmp = attendanceSummary['present'] + attendanceSummary['absent'];
                    @let presentPer = (attendanceSummary['present'] / totalEmp) * 100;
                    <p class="mb-1">Present: <strong>{{presentPer | number: '0.0-2'}}%</strong> | Absent: <strong>{{attendanceSummary['absent']}}</strong></p>
                    <p class="mb-0">Late Check-ins: <strong>{{attendanceSummary['lateCheckins']}}</strong></p>
                } @loading {
                    <p class="card-text placeholder-glow"><span class="placeholder col-7"></span><span class="placeholder col-4"></span></p>
                    <p class="card-text placeholder-glow"><span class="placeholder col-7"></span><span class="placeholder col-4"></span></p>
                } @placeholder {
                    <p class="card-text placeholder-glow"><span class="placeholder col-7"></span><span class="placeholder col-4"></span></p>
                    <p class="card-text placeholder-glow"><span class="placeholder col-7"></span><span class="placeholder col-4"></span></p>
                }
            </div>
        </div>
        <div class="col-sm-6">
            <div class="card p-3">
                <h5>Payroll Summary</h5>
                <p>Upcoming Payroll: 5 days</p>
                <p>Salary Disbursed: 90%</p>
            </div>
        </div>
    </div>
    
    <!-- Recent Activity -->
    @defer (when (isActivityLoaded && (activitis.length > 0 || activitySkip > 0))) {
        <section class="card mt-4">
            <h4 class="p-3">Recent Activity</h4>
            <table class="table table-striped table">
                <thead class="table-secondary">
                    <tr>
                        <th>#</th>
                        <th>Employee</th>
                        <th>Action</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    @for (item of activitis; track item.uuid) {
                        @let newDate = formatDate(item.createdAt);
                        <tr>
                            <td>{{$index+1}}</td>
                            <td>{{item.userName}}</td>
                            <td>{{item.action}}</td>
                            <td>{{newDate | date}}</td>
                        </tr>
                    }
                </tbody>
            </table>
            @if (isMoreActivity || activitySkip > 0) {
                <nav aria-label="Navigation for activities">
                    <ul class="pagination pagination-sm ms-auto px-3">
                      <li class="page-item ms-auto" [class.disabled]="activitySkip < 1">
                        <span class="page-link" role="button" (click)="loadActivities($event, -1)" [tabIndex]="-1">Previous</span>
                      </li>
                      <li class="page-item" [class.disabled]="!isMoreActivity">
                        <a class="page-link" href="#" role="button" (click)="loadActivities($event, 1)" [tabIndex]="-1">Next</a>
                      </li>
                    </ul>
                </nav>
            }
        </section>
    }

    <!-- Quick Actions -->
    <div class="row g-2 mt-3">
        @if (loggedinUser !== null && loggedinUser.permissions.includes('employee')) {
            <div class="col-6 col-md-4 col-lg-3">
                <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#employeeModal"><i class="bi bi-person-plus"></i> Add Employee</button>
            </div>
        }
        <div class="col-6 col-md-4 col-lg-3">
            <button class="btn btn-warning w-100"><i class="bi bi-people"></i> Assign Roles</button>
        </div>
        <div class="col-6 col-md-4 col-lg-3">
            <button class="btn btn-info w-100"><i class="bi bi-file-earmark-text"></i> Generate Report</button>
        </div>
    </div>
</section>
@if (loggedinUser !== null && loggedinUser.permissions.includes('employee')) {
    <!-- Employee Modal -->
    <div class="modal fade" id="employeeModal" data-bs-backdrop="static" data-bs-keyboard="false" aria-labelledby="modalLabel" aria-hidden="true" tabindex="-1">
        <div class="modal-dialog modal-lg modal-fullscreen-lg-down modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">Add Employee</h5>
                    <button type="button" class="btn-close" [tabIndex]="-1" data-bs-dismiss="modal" aria-label="Close" data-bs-toggle="tooltip" title="Close modal" aria-label="Close table"[id]="'closeModalBtn'" (click)="toggleReset()"></button>
                </div>
                <div class="modal-body">
                    <form [formGroup]="employeeForm">
                        <app-employee-form [resetAll]="requiredReset" />
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal" (click)="toggleReset()">Close</button>
                    <button type="button" class="btn btn-primary" [disabled]="employeeForm.invalid" (click)="onSubmit($event)">Save changes</button>
                </div>
            </div>
        </div>
    </div>
}