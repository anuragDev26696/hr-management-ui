<section class="content py-3 container-xl">
    <div class="row g-3">
        @defer (when isMasterSummaryLoaded) {
            <aside class="col-sm-6 col-md-4 col-xl-3">
                <div class="card topCards p-3 text-bg-primary text-end">
                    <img src="cover/pie-chart.png" alt="Pie Chart" [width]="100" [height]="100" loading="lazy" class="object-fit-contain">
                    <p class="h5 mb-1">Employees</p>
                    <p class="mb-0">
                        Total:<span class="h3"> {{masterSummary.totalEmployee}}</span><br>
                        Active:<span class="h3"> {{masterSummary.activeEmployee}}</span>
                    </p>
                </div>
            </aside>
            @for (item of masterSummary | keyvalue; track item.key) {
                @if (!['totalEmployee', 'activeEmployee'].includes(item.key)) {
                    <aside class="col-sm-6 col-md-4 col-xl-3">
                        <div class="card topCards p-3 text-end {{item.key}}">
                            <p class="h5 mb-1">{{item.key === "departments" ? "Departments" : item.key === "leaveRequest" ? "Leave Request" : item.key === "recentRegistrations" ? "Recent Registrations" : ""}} </p>
                            <span class="h3">{{item.value}}</span>
                            @if (item.key === 'recentRegistrations') {
                                <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24" id="chart">
                                    <path fill="#3071f1" d="M6.604,8.625H5.396c-0.839,0-1.521,0.682-1.521,1.521v9.334C3.875,20.318,4.557,21,5.396,21h1.209
                                      c0.839,0,1.521-0.682,1.521-1.521v-9.334C8.125,9.307,7.443,8.625,6.604,8.625z"></path>
                                    <path fill="#90b2f2" d="M18.604 10.833h-1.209c-.839 0-1.521.683-1.521 1.521v7.125c0 .839.682 1.521 1.521 1.521h1.209c.839 0 1.521-.682 1.521-1.521v-7.125C20.125 11.516 19.443 10.833 18.604 10.833zM12.604 3h-1.209c-.839 0-1.521.682-1.521 1.521v14.959c0 .839.682 1.521 1.521 1.521h1.209c.839 0 1.521-.682 1.521-1.521V4.521C14.125 3.682 13.443 3 12.604 3z"></path>
                                </svg>
                            } @else if (item.key === "departments") {
                                <svg width="100" height="100" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="4" y="4" width="40" height="40" rx="4" fill="#3f51b5" />
                                    <rect x="10" y="10" width="8" height="8" rx="2" fill="white" />
                                    <rect x="20" y="10" width="8" height="8" rx="2" fill="white" />
                                    <rect x="30" y="10" width="8" height="8" rx="2" fill="white" />
                                    <rect x="10" y="20" width="8" height="8" rx="2" fill="white" />
                                    <rect x="20" y="20" width="8" height="8" rx="2" fill="white" />
                                    <rect x="30" y="20" width="8" height="8" rx="2" fill="white" />
                                    <rect x="10" y="30" width="28" height="4" rx="2" fill="white" />
                                </svg>
                            } @else if (item.key === "leaveRequest") {
                                <svg width="100" height="100" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <!-- Calendar Base -->
                                    <rect x="6" y="8" width="36" height="32" rx="4" fill="#ff9800"/>
                                    <rect x="6" y="16" width="36" height="24" fill="white"/>
                                    
                                    <!-- Calendar Header -->
                                    <rect x="6" y="8" width="36" height="8" fill="#f57c00"/>
                                    
                                    <!-- Calendar Rings -->
                                    <rect x="14" y="4" width="4" height="8" rx="2" fill="#fff"/>
                                    <rect x="30" y="4" width="4" height="8" rx="2" fill="#fff"/>
                                  
                                    <!-- Clock Circle -->
                                    <circle cx="36" cy="32" r="6" fill="#ff9800"/>
                                    <!-- Clock Hands -->
                                    <line x1="36" y1="32" x2="36" y2="28" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                    <line x1="36" y1="32" x2="38.5" y2="33.5" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                  </svg>                                                                 
                            } @else {
                                <img src="cover/pie-chart.png" alt="Pie Chart" [width]="100" [height]="100" loading="lazy" class="object-fit-contain">
                            }
                        </div>
                    </aside>
                }
            }
        } @placeholder {
            @for (item of masterSummary | keyvalue; track item.key) {
                <aside class="col-sm-6 col-md-4 col-xl-3">
                    <div class="card p-3 placeholder-glow">
                        <p class="h5 rounded-1 mt-auto placeholder col-10"></p>
                        <h3 class="w-100 rounded-1 placeholder col-5"></h3>
                    </div>
                </aside>
            }
        }
        <div class="col-12">
            @if (loggedinUser !== null && loggedinUser.permissions.includes('employee')) {
                <div class="card border-dark text-center text-white rounded-3 p-3 addEmpCard">
                    <!-- <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 16 16" id="add-user">
                        <path fill="#212121" d="M11.5,7 C13.9853,7 16,9.01472 16,11.5 C16,13.9853 13.9853,16 11.5,16 C9.01472,16 7,13.9853 7,11.5 C7,9.01472 9.01472,7 11.5,7 Z M11.5,9 C11.2239,9 11,9.22386 11,9.5 L11,11 L9.5,11 C9.22386,11 9,11.2239 9,11.5 C9,11.7761 9.22386,12 9.5,12 L11,12 L11,13.5 C11,13.7761 11.2239,14 11.5,14 C11.7761,14 12,13.7761 12,13.5 L12,12 L13.5,12 C13.7761,12 14,11.7761 14,11.5 C14,11.2239 13.7761,11 13.5,11 L12,11 L12,9.5 C12,9.22386 11.7761,9 11.5,9 Z M7.25716,8 C7.0669375,8.2303325 6.89511438,8.476415 6.74393078,8.73599891 L6.59971,9 L3.5,9 C3.25454222,9 3.0503921,9.17687704 3.00805575,9.41012499 L3,9.5 L3,10.2746 C3,11.4138 3.917,11.9939 6.02249,12.0007 C6.05345,12.3438 6.11593,12.6778 6.20699,12.9998 L6.06019,13.0008 L6.06019,13.0008 C3.53267567,13.0008 2.09766706,12.1561557 2.00480816,10.4537692 L2,10.2746 L2,9.5 C2,8.72030118 2.59488554,8.079551 3.35553954,8.00686655 L3.5,8 L7.25716,8 Z M6,2 C7.38094,2 8.50041,3.11947 8.50041,4.5004 C8.50041,5.88134 7.38094,7.00081 6,7.00081 C4.61906,7.00081 3.49959,5.88134 3.49959,4.5004 C3.49959,3.11947 4.61906,2 6,2 Z M11,3 C12.1046,3 13,3.89543 13,5 C13,5.41572 12.8732,5.80182 12.6561,6.12171 C12.2833,6.04197 11.8966,6 11.5,6 C10.8076,6 10.1452,6.12793 9.53491,6.36145 C9.203,6.00443 9,5.52592 9,5 C9,3.89543 9.89543,3 11,3 Z M6,3 C5.17135,3 4.4996,3.67175 4.4996,4.5004 C4.4996,5.32906 5.17135,6.00081 6,6.00081 C6.82865,6.00081 7.5004,5.32906 7.5004,4.5004 C7.5004,3.67175 6.82865,3 6,3 Z M11,4 C10.4477,4 10,4.44772 10,5 C10,5.55228 10.4477,6 11,6 C11.5523,6 12,5.55228 12,5 C12,4.44772 11.5523,4 11,4 Z"></path>
                    </svg> -->
                    <h4>Add New Employee</h4>
                    <p class="text-wrap-balance w-75 mx-auto">Easily onboard new team members by filling out their essential details. Make sure to provide accurate information for seamless integration into the organization.</p>
                    <button class="btn mx-auto btn-lg shadow" data-bs-toggle="modal" data-bs-target="#employeeModal" (click)="openUserModal($event)">
                        <i class="bi bi-person-plus"></i> Add Employee
                    </button>
                </div>
            }
        </div>
        <!-- Attendance & Payroll Overview -->
        @if (today.getDay() > 0) {
            <div class="col-sm-6 col-md-4">
                <div class="card border-light shadow-sm p-3">
                    <h5>Today's Attendance &nbsp;<span role="button" class="float-end text-primary rounded-5" [tabIndex]="-1" aria-label="Refresh to get latest status" (click)="refreshSummary($event)"><i class="bi bi-arrow-clockwise"></i></span></h5>
                    @defer (when attendanceSummary) {
                        @let totalEmp = attendanceSummary['present'] + attendanceSummary['absent'];
                        @let presentPer = (attendanceSummary['present'] / totalEmp) * 100;
                        <p class="mb-1">Present: <strong>{{presentPer | number: '0.0-2'}}%</strong> | Absent: <strong>{{attendanceSummary['absent']}}</strong></p>
                        <p class="mb-0">Late Check-ins: <strong>{{attendanceSummary['lateCheckins']}}</strong></p>
                    } @loading {
                        <p class="card-text placeholder-glow"><span class="placeholder col-7"></span><span class="placeholder col-4"></span></p>
                        <p class="card-text placeholder-glow"><span class="placeholder col-7"></span><span class="placeholder col-4"></span></p>
                    } @placeholder {
                        <p class="card-text placeholder-glow"><span class="placeholder col-7"></span><span class="placeholder col-4"></span></p>
                        <p class="card-text placeholder-glow"><span class="placeholder col-7"></span><span class="placeholder col-4"></span></p>
                    }
                </div>
            </div>
        }
    </div>
    
    <!-- Recent Activity -->
    @defer (when (isActivityLoaded && (activitis.length > 0 || activitySkip > 0))) {
        <section class="card mt-4">
            <h4 class="p-3">Recent Activity</h4>
            <table class="table table-striped table">
                <thead class="table-secondary">
                    <tr>
                        <th>#</th>
                        <th>Employee</th>
                        <th>Action</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    @for (item of activitis; track item.uuid) {
                        @let newDate = formatDate(item.createdAt);
                        <tr>
                            <td>{{$index+1}}</td>
                            <td>{{item.userName}}</td>
                            <td>{{item.action}}</td>
                            <td>{{newDate | date}}</td>
                        </tr>
                    }
                </tbody>
            </table>
            @if (isMoreActivity || activitySkip > 0) {
                <nav aria-label="Navigation for activities">
                    <ul class="pagination pagination-sm ms-auto px-3">
                      <li class="page-item ms-auto" [class.disabled]="activitySkip < 1">
                        <span class="page-link" role="button" (click)="loadActivities($event, -1)" [tabIndex]="-1">Previous</span>
                      </li>
                      <li class="page-item" [class.disabled]="!isMoreActivity">
                        <a class="page-link" href="#" role="button" (click)="loadActivities($event, 1)" [tabIndex]="-1">Next</a>
                      </li>
                    </ul>
                </nav>
            }
        </section>
    }

    <!-- Quick Actions -->
    <!-- <div class="row g-2 mt-3">
        <div class="col-6 col-md-4 col-lg-3">
            <button class="btn btn-warning w-100" data-bs-target="#assignRoleModal" data-bs-toggle="modal"><i class="bi bi-people"></i> Assign Roles</button>
        </div>
        <div class="col-6 col-md-4 col-lg-3">
            <button class="btn btn-info w-100"><i class="bi bi-file-earmark-text"></i> Generate Report</button>
        </div>
    </div> -->
    <!-- Assing Role Modal -->
    <div class="modal fade" id="assignRoleModal" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true" tabindex="-1" aria-labelledby="assignRoleModalLabel">
        <div class="modal-dialog modal-fullscreen-sm-down modal-dialog-centered modal-dialog-scrollable">
          <app-assign-role/>
        </div>
    </div>
</section>
@if (loggedinUser !== null && loggedinUser.permissions.includes('employee')) {
    <!-- Employee Modal -->
    <div class="modal fade" id="employeeModal" data-bs-backdrop="static" data-bs-keyboard="false" aria-labelledby="modalLabel" aria-hidden="true" tabindex="-1">
        <div class="modal-dialog modal-fullscreen-md-down modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">Add Employee</h5>
                    <button type="button" class="btn-close" [tabIndex]="-1" data-bs-dismiss="modal" aria-label="Close" data-bs-toggle="tooltip" title="Close modal" aria-label="Close table" [id]="'empFormCloseBtn'"></button>
                </div>
                <div class="modal-body">
                    <app-employee-form />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" [disabled]="employeeForm.invalid || employeeForm.disabled || employeeForm.untouched" (click)="onSubmit($event)">Save changes</button>
                </div>
            </div>
        </div>
    </div>
}